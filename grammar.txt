line_
    : EOL
    | line EOL

line
    : BITS NUM
    | label
    | instruction

label
    : LABEL COLON

instruction
    : mnemonic_ instruction_tail?

instruction_tail
    : operand_ COMMA operand_
    | operand_
    | LABEL

mnemonic_
    : prefix* mnemonic

operand_
    : opr_prefix* operand

opr_prefix
    : opr_size
    | seg_ovr

seg_ovr
    : register_segment COLON

operand
    : register_general
    | eaddr__
    | register_segment
    | pointer
    | imm
    | LABEL

imm
    : opr_math? (NUM | NUM_ZERO)

pointer
    NUM COLON NUM

prefix
    : LOCK
    | REP
    | REPE
    | REPNE
    | REPZ
    | REPNZ

eaddr__
    : LSQUARE_BR eaddr_ RSQUARE_BR

eaddr_
    : (PLUS)? eaddr

eaddr
    : register_base PLUS register_index signed_num?
    | register_base                     signed_num?
    |                    register_index signed_num?
    | direct_addr

direct_addr
    : opr_math? (NUM|NUM_ZERO)

signed_num
    : opr_math NUM

signed_zero
    : opr_math NUM_ZERO

mnemonic
    : MOV
    | PUSH
    | POP

register_base
    : BX | BP

register_index
    : SI | DI

register_general
    : AX | AL | AH | BX | BL | BH | CX | CL | CH | DX | DL | DH | SP | BP | SI | DI

register_segment
    : CS | DS | SS | ES

opr_math
    : PLUS | MINUS

opr_size
    : BYTE | WORD

